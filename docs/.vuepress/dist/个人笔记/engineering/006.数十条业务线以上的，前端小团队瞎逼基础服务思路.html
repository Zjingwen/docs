<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>006.不浅谈，就是让你看一看，数十条业务线以上的，前端小团队瞎逼基础服务思路 | 伪公知的生活常态</title>
    <meta name="description" content="就是随便写写而已">
    
    
    <link rel="preload" href="/docs-interview/assets/css/0.styles.5db48745.css" as="style"><link rel="preload" href="/docs-interview/assets/js/app.95d31192.js" as="script"><link rel="preload" href="/docs-interview/assets/js/2.387e38e1.js" as="script"><link rel="preload" href="/docs-interview/assets/js/21.dceec1d2.js" as="script"><link rel="prefetch" href="/docs-interview/assets/js/10.3d791bab.js"><link rel="prefetch" href="/docs-interview/assets/js/100.26536cc9.js"><link rel="prefetch" href="/docs-interview/assets/js/101.ef604d61.js"><link rel="prefetch" href="/docs-interview/assets/js/102.7e3745f8.js"><link rel="prefetch" href="/docs-interview/assets/js/103.dd883182.js"><link rel="prefetch" href="/docs-interview/assets/js/104.79252216.js"><link rel="prefetch" href="/docs-interview/assets/js/105.c827c675.js"><link rel="prefetch" href="/docs-interview/assets/js/106.89a21ec7.js"><link rel="prefetch" href="/docs-interview/assets/js/107.0c04e9d8.js"><link rel="prefetch" href="/docs-interview/assets/js/108.d49a0e1d.js"><link rel="prefetch" href="/docs-interview/assets/js/109.8fa00ff0.js"><link rel="prefetch" href="/docs-interview/assets/js/11.e7b6e7fe.js"><link rel="prefetch" href="/docs-interview/assets/js/110.eb0cdcaa.js"><link rel="prefetch" href="/docs-interview/assets/js/111.5d84d049.js"><link rel="prefetch" href="/docs-interview/assets/js/112.026e50e0.js"><link rel="prefetch" href="/docs-interview/assets/js/113.4af81b4c.js"><link rel="prefetch" href="/docs-interview/assets/js/114.65b24c1f.js"><link rel="prefetch" href="/docs-interview/assets/js/115.ab03d442.js"><link rel="prefetch" href="/docs-interview/assets/js/116.4cabfb7a.js"><link rel="prefetch" href="/docs-interview/assets/js/117.b866a639.js"><link rel="prefetch" href="/docs-interview/assets/js/118.4e903d7a.js"><link rel="prefetch" href="/docs-interview/assets/js/119.6d8406b8.js"><link rel="prefetch" href="/docs-interview/assets/js/12.d872e8ea.js"><link rel="prefetch" href="/docs-interview/assets/js/120.10dbccf5.js"><link rel="prefetch" href="/docs-interview/assets/js/121.f62c4740.js"><link rel="prefetch" href="/docs-interview/assets/js/122.2e228b20.js"><link rel="prefetch" href="/docs-interview/assets/js/123.ee925db9.js"><link rel="prefetch" href="/docs-interview/assets/js/124.cbb6d23a.js"><link rel="prefetch" href="/docs-interview/assets/js/125.71f51813.js"><link rel="prefetch" href="/docs-interview/assets/js/126.8001dc97.js"><link rel="prefetch" href="/docs-interview/assets/js/127.0a8c3722.js"><link rel="prefetch" href="/docs-interview/assets/js/128.e12abd8a.js"><link rel="prefetch" href="/docs-interview/assets/js/129.522f352d.js"><link rel="prefetch" href="/docs-interview/assets/js/13.7b075aef.js"><link rel="prefetch" href="/docs-interview/assets/js/130.19f0c66a.js"><link rel="prefetch" href="/docs-interview/assets/js/131.f00f9466.js"><link rel="prefetch" href="/docs-interview/assets/js/132.4b0118bd.js"><link rel="prefetch" href="/docs-interview/assets/js/133.f3f8534a.js"><link rel="prefetch" href="/docs-interview/assets/js/134.65772645.js"><link rel="prefetch" href="/docs-interview/assets/js/135.c110e3ec.js"><link rel="prefetch" href="/docs-interview/assets/js/136.47679aee.js"><link rel="prefetch" href="/docs-interview/assets/js/137.3cb1e73e.js"><link rel="prefetch" href="/docs-interview/assets/js/138.83e86e9f.js"><link rel="prefetch" href="/docs-interview/assets/js/139.ac6b71e3.js"><link rel="prefetch" href="/docs-interview/assets/js/14.a4e38186.js"><link rel="prefetch" href="/docs-interview/assets/js/140.79b340d4.js"><link rel="prefetch" href="/docs-interview/assets/js/141.4b3c867a.js"><link rel="prefetch" href="/docs-interview/assets/js/142.be834fd0.js"><link rel="prefetch" href="/docs-interview/assets/js/143.b147bf79.js"><link rel="prefetch" href="/docs-interview/assets/js/144.0573c750.js"><link rel="prefetch" href="/docs-interview/assets/js/15.13b1d63f.js"><link rel="prefetch" href="/docs-interview/assets/js/16.d53c70f1.js"><link rel="prefetch" href="/docs-interview/assets/js/17.17b5fcbe.js"><link rel="prefetch" href="/docs-interview/assets/js/18.5589dd51.js"><link rel="prefetch" href="/docs-interview/assets/js/19.446dab5a.js"><link rel="prefetch" href="/docs-interview/assets/js/20.351088ff.js"><link rel="prefetch" href="/docs-interview/assets/js/22.fa7f6c47.js"><link rel="prefetch" href="/docs-interview/assets/js/23.a2c2a19a.js"><link rel="prefetch" href="/docs-interview/assets/js/24.b5676ea3.js"><link rel="prefetch" href="/docs-interview/assets/js/25.eb9588a1.js"><link rel="prefetch" href="/docs-interview/assets/js/26.cf397d24.js"><link rel="prefetch" href="/docs-interview/assets/js/27.1da5c841.js"><link rel="prefetch" href="/docs-interview/assets/js/28.26285cb6.js"><link rel="prefetch" href="/docs-interview/assets/js/29.4d4a7d7f.js"><link rel="prefetch" href="/docs-interview/assets/js/3.e24aff58.js"><link rel="prefetch" href="/docs-interview/assets/js/30.21cc19bf.js"><link rel="prefetch" href="/docs-interview/assets/js/31.f1b289e2.js"><link rel="prefetch" href="/docs-interview/assets/js/32.723e67e2.js"><link rel="prefetch" href="/docs-interview/assets/js/33.02053b5b.js"><link rel="prefetch" href="/docs-interview/assets/js/34.5e62f8a4.js"><link rel="prefetch" href="/docs-interview/assets/js/35.63c58f1e.js"><link rel="prefetch" href="/docs-interview/assets/js/36.06f274ed.js"><link rel="prefetch" href="/docs-interview/assets/js/37.ea004859.js"><link rel="prefetch" href="/docs-interview/assets/js/38.d3d9c594.js"><link rel="prefetch" href="/docs-interview/assets/js/39.c5af91c3.js"><link rel="prefetch" href="/docs-interview/assets/js/4.e2e0255b.js"><link rel="prefetch" href="/docs-interview/assets/js/40.d48fe4bb.js"><link rel="prefetch" href="/docs-interview/assets/js/41.b2215e85.js"><link rel="prefetch" href="/docs-interview/assets/js/42.6ecc20b2.js"><link rel="prefetch" href="/docs-interview/assets/js/43.d48d7214.js"><link rel="prefetch" href="/docs-interview/assets/js/44.f56d3e66.js"><link rel="prefetch" href="/docs-interview/assets/js/45.7c5d2214.js"><link rel="prefetch" href="/docs-interview/assets/js/46.cad73163.js"><link rel="prefetch" href="/docs-interview/assets/js/47.3a25ff94.js"><link rel="prefetch" href="/docs-interview/assets/js/48.98d159e1.js"><link rel="prefetch" href="/docs-interview/assets/js/49.fe28623a.js"><link rel="prefetch" href="/docs-interview/assets/js/5.cd3fd4c9.js"><link rel="prefetch" href="/docs-interview/assets/js/50.f2d2864e.js"><link rel="prefetch" href="/docs-interview/assets/js/51.3e9ede3a.js"><link rel="prefetch" href="/docs-interview/assets/js/52.ca7b5f42.js"><link rel="prefetch" href="/docs-interview/assets/js/53.b47bf86d.js"><link rel="prefetch" href="/docs-interview/assets/js/54.6a2cbaf5.js"><link rel="prefetch" href="/docs-interview/assets/js/55.91582a90.js"><link rel="prefetch" href="/docs-interview/assets/js/56.f86be0ea.js"><link rel="prefetch" href="/docs-interview/assets/js/57.9736ae8a.js"><link rel="prefetch" href="/docs-interview/assets/js/58.6733876e.js"><link rel="prefetch" href="/docs-interview/assets/js/59.4427ecfe.js"><link rel="prefetch" href="/docs-interview/assets/js/6.0d618875.js"><link rel="prefetch" href="/docs-interview/assets/js/60.b550f66b.js"><link rel="prefetch" href="/docs-interview/assets/js/61.ee9258ec.js"><link rel="prefetch" href="/docs-interview/assets/js/62.db3c66c4.js"><link rel="prefetch" href="/docs-interview/assets/js/63.d2fd7240.js"><link rel="prefetch" href="/docs-interview/assets/js/64.258b5a42.js"><link rel="prefetch" href="/docs-interview/assets/js/65.bb395bbf.js"><link rel="prefetch" href="/docs-interview/assets/js/66.bd6896bd.js"><link rel="prefetch" href="/docs-interview/assets/js/67.37657eee.js"><link rel="prefetch" href="/docs-interview/assets/js/68.d823ca9e.js"><link rel="prefetch" href="/docs-interview/assets/js/69.0f13b4d0.js"><link rel="prefetch" href="/docs-interview/assets/js/7.2302c4c8.js"><link rel="prefetch" href="/docs-interview/assets/js/70.2c1ecb69.js"><link rel="prefetch" href="/docs-interview/assets/js/71.6aee0b5d.js"><link rel="prefetch" href="/docs-interview/assets/js/72.9804d57b.js"><link rel="prefetch" href="/docs-interview/assets/js/73.a362afdf.js"><link rel="prefetch" href="/docs-interview/assets/js/74.00b3e003.js"><link rel="prefetch" href="/docs-interview/assets/js/75.3ba2741c.js"><link rel="prefetch" href="/docs-interview/assets/js/76.b155e834.js"><link rel="prefetch" href="/docs-interview/assets/js/77.c0806518.js"><link rel="prefetch" href="/docs-interview/assets/js/78.f145e4e5.js"><link rel="prefetch" href="/docs-interview/assets/js/79.b18eb052.js"><link rel="prefetch" href="/docs-interview/assets/js/8.01ef5034.js"><link rel="prefetch" href="/docs-interview/assets/js/80.166faa3b.js"><link rel="prefetch" href="/docs-interview/assets/js/81.a8e13dd1.js"><link rel="prefetch" href="/docs-interview/assets/js/82.bc659265.js"><link rel="prefetch" href="/docs-interview/assets/js/83.d4d2767e.js"><link rel="prefetch" href="/docs-interview/assets/js/84.e59df14e.js"><link rel="prefetch" href="/docs-interview/assets/js/85.60f7cc9e.js"><link rel="prefetch" href="/docs-interview/assets/js/86.02c79022.js"><link rel="prefetch" href="/docs-interview/assets/js/87.cd092a77.js"><link rel="prefetch" href="/docs-interview/assets/js/88.ce7120fa.js"><link rel="prefetch" href="/docs-interview/assets/js/89.eca17faa.js"><link rel="prefetch" href="/docs-interview/assets/js/9.062415ef.js"><link rel="prefetch" href="/docs-interview/assets/js/90.81085990.js"><link rel="prefetch" href="/docs-interview/assets/js/91.1dc2aee4.js"><link rel="prefetch" href="/docs-interview/assets/js/92.229f99c0.js"><link rel="prefetch" href="/docs-interview/assets/js/93.b4169369.js"><link rel="prefetch" href="/docs-interview/assets/js/94.fdf0a2cb.js"><link rel="prefetch" href="/docs-interview/assets/js/95.2fb1a9f0.js"><link rel="prefetch" href="/docs-interview/assets/js/96.2d63b1cb.js"><link rel="prefetch" href="/docs-interview/assets/js/97.efed770d.js"><link rel="prefetch" href="/docs-interview/assets/js/98.c6c86090.js"><link rel="prefetch" href="/docs-interview/assets/js/99.c0733e0b.js">
    <link rel="stylesheet" href="/docs-interview/assets/css/0.styles.5db48745.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs-interview/" class="home-link router-link-active"><!----> <span class="site-name">伪公知的生活常态</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/docs-interview/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/" class="sidebar-link">个人笔记</a></li><li><a href="/docs-interview/%E6%94%B6%E8%97%8F%E7%AC%94%E8%AE%B0/" class="sidebar-link">收藏笔记</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_006-不浅谈，就是让你看一看，数十条业务线以上的，前端小团队瞎逼基础服务思路"><a href="#_006-不浅谈，就是让你看一看，数十条业务线以上的，前端小团队瞎逼基础服务思路" aria-hidden="true" class="header-anchor">#</a> 006.不浅谈，就是让你看一看，数十条业务线以上的，前端小团队瞎逼基础服务思路</h1> <p>！！！高能预警，长文，我都不知道多少字。</p> <p>背景</p> <p>我嘛，虽然不是出身bat，写了三年多业务代码，18年开始带团队至今，从toB的pc、管理台、小程序、微信公众号、app、活动、服务端，都有涉猎。当然公司小，我这种人就是跟着公司一点一点成长起来的，没有前人栽树，只能自己动手，天资不够，只能靠肝。大概在17年底的时候，带我的老大（老大呀，看到文章别diss我）离职了，我就这样被赶鸭子上架（其实我的心态是崩溃的，没玩过呀）做了起了前端负责人，后来经历老员工离职，招聘，新员工入职，公司明确业务，业务量爆发，前端业务线暴涨之后，有幸做一些简单的基础服务，这套东西能让3个前端，应付10条以上业务线，我可以自豪的说1年多以来，单季度，bug数&lt;=1、技术问题延期&lt;=0。经历了百来个活动页，3个移动端，8个管理台，1个pc商城，2个小程序，上千万的pv，各种瞎逼情况慢慢磨练出来的。历时至今，1年半的时间，我算是做出了一些，我想做的事情。</p> <p>目前全公司涉及前端业务线</p> <ul><li><p>mobile 3条</p> <ul><li>商城性质</li> <li>管理性质</li> <li>活动性质</li></ul></li> <li><p>小程序 2条</p> <ul><li>商城性质</li> <li>备用小程序</li></ul></li> <li><p>pc端  9条</p> <ul><li>对外商城性质</li> <li>对外数据管理台</li> <li>内部运营管理台</li> <li>内部自营管理台</li> <li>内部财务管理台</li> <li>半内半外的招商管理台</li> <li>对外第三方商家管理台</li> <li>旧，运营管理台</li> <li>旧，招商管理台</li></ul></li></ul> <h2 id="基础服务"><a href="#基础服务" aria-hidden="true" class="header-anchor">#</a> 基础服务</h2> <h3 id="技术栈选择"><a href="#技术栈选择" aria-hidden="true" class="header-anchor">#</a> 技术栈选择</h3> <ul><li>移动端</li></ul> <p>技术栈选择Vue全家桶，从我的视角来说，移动端的交互不会特别复杂，最多sku选择、地址、动画，而且这一块大部分都是纯面向用户的需求，很难做业务收束，而且很难解耦。基于我的思考，我就想到vue了，轻便、简单、插件丰富，vue满足我的所有需求。说简单点，我一个业务new个Vue对象，写一堆配置/方法就搞定了。活动的话，我选择了nuxt，活动这种轻便的东西，我静态化就好了。</p> <ul><li>pc端</li></ul> <p>技术栈选择React全家桶，从我的视角来说，pc端我面向的都是管理台需求居多，涉及的交互可能会相对而言复杂，会有拖拽、富文本、页面编辑、图表等等交互出现，这个时候React这种以Component为基本单位的库对于这类业务来说，就很舒服了，解耦不要太爽。</p> <ul><li>小程序用原生</li></ul> <p>我这边就只有微信小程序，原生确实够用了，而且原生小程序框架也越来越强大，等需要扩展渠道时，我再选择Taro、mpVue等东西。</p> <ul><li>npm</li></ul> <p>请搭建私有的npm，可以做到公共方法的收集，集中化处理。</p> <ul><li>mock平台</li></ul> <p>搭建0业务入侵的mock平台。</p> <ul><li>nginx管理</li></ul> <p>集中管理前端的nginx。</p> <ul><li>git仓库</li></ul> <p>gitlab天下第一。</p> <ul><li>项目模版</li></ul> <p>将vue、react根据业务，制作为基础模版，以后展开新业务直接copy即可。</p> <ul><li>持续发布</li></ul> <p>jekins天下第一</p> <ul><li>eslint</li></ul> <p>服务器初始化</p> <ul><li>脚本</li></ul> <p>总结：其实最有争议的应该是技术栈的选择了，为啥要既有vue、又有react、还有小程序、nuxt，不好意思，我觉得在不同场景下，使用不同的库是合理的。并且作为一个程序员，你的学习能力跟不上，那你还是自己走吧。我还没上typeScript、Rx.js呢。还有就是招聘问题，不好意思，当面试者问我公司前端技术栈时，大部分都跃跃欲试。成本吧，反正不贵。</p> <h2 id="具体实现"><a href="#具体实现" aria-hidden="true" class="header-anchor">#</a> 具体实现</h2> <p>这里我只对，nginx管理、私有的npm、mock平台、项目模版、服务器初始化，做详细具体解释。其余的提一点，就不做解释了，因为jekins就是配置，这个业务性太强，eslint没啥讲的，git仓库也没啥讲的，小程序原生、pc端、移动端这都是纯业务的东西，也没啥讲的。</p> <h3 id="nginx管理"><a href="#nginx管理" aria-hidden="true" class="header-anchor">#</a> nginx管理</h3> <p>新建nginxConfig文件夹，目录结构如下。</p> <div class="language-txt extra-class"><pre class="language-text"><code>nginxConfig
|----- build.sh                                 # 脚本
|----- server.develop.xxxx.com.conf             # 对外服务的nginx配置
|----- server.develop.xxxx.com.ssl.conf         # 对外服务的nginx，https配置
|----- server.test.xxxx.com.conf                # 测试服务器的nginx配置，涵盖所有业务
|----- server.test.xxxx.com.ssl.conf            # 测试服务器的nginx，https配置，涵盖所有业务
|----- server.admin.xxxx.com.conf               # 管理台的nginx配置
|----- server.admin.xxxx.com.conf.ssl.conf      # 管理台的nginx，https配置
</code></pre></div><p>请善用脚本，其实我只需要将nginx，发布到服务器上面根据不同服务器，cp不同nginx配置，然后relaod即可。nginx重启失败我倒是没有碰过，我用这套已经部署了n台活动服务器、n台管理台服务器。当然，写nginx时请在测试服务器谨慎测试。我一般是凌晨3、4点去折腾的，谁叫我肝好呢。</p> <p>附上脚本代码</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># /bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;请选择你要替换的nginx&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;1) 替换xxxx，nginx&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;2) 替换xxxx，https的nginx&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;3) 替换xxxx，的nginx&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;4) 替换xxxx，https的nginx&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;5) 替换xxxx，的nginx&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;6) 替换xxxx，https的nginx&quot;</span>

<span class="token builtin class-name">read</span> number
<span class="token keyword">case</span> <span class="token variable">$number</span> <span class="token keyword">in</span>
<span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;替换xxxx，http的nginx&quot;</span>
  <span class="token punctuation">\</span>cp server.admin.xxxx.com.conf /etc/nginx/conf.d/
  <span class="token function">service</span> nginx -reload
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;替换xxxx，https的nginx&quot;</span>
  <span class="token punctuation">\</span>cp server.admin.xxxx.com.ssl.conf /etc/nginx/conf.d/
  <span class="token function">service</span> nginx -reload
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;替换xxxx的nginx&quot;</span>
  <span class="token punctuation">\</span>cp server.test.xxxx.com.conf /etc/nginx/conf.d/
  <span class="token function">service</span> nginx -reload
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;替换xxxx，https的nginx&quot;</span>
  <span class="token punctuation">\</span>cp server.test.xxxx.com.ssl.conf /etc/nginx/conf.d/
  <span class="token function">service</span> nginx -reload
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;替换xxxx的nginx&quot;</span>
  <span class="token punctuation">\</span>cp server.develop.xxxx.com.conf /etc/nginx/conf.d/
  <span class="token function">service</span> nginx -reload
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;替换xxxx，https的nginx&quot;</span>
  <span class="token punctuation">\</span>cp server.develop.xxxx.com.ssl.conf /etc/nginx/conf.d/
  <span class="token function">service</span> nginx -reload
<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
</code></pre></div><p>告诉你通过脚本编写好处，别看我现在虽然是手动到服务器上去git pull 然后sh build脚本，我完全可以无缝的切到jekins，因为我是脚本呀，配置执行命令就好了呀。我把输入判断改为常量不就好了么。</p> <h3 id="nginx配置"><a href="#nginx配置" aria-hidden="true" class="header-anchor">#</a> nginx配置</h3> <p>我只做了最简单nginx配置，没有优化，我还没空去细致研究，其实这一层还能做很多。但是我简单的需求就是，通过域名的路径去匹配页面，然后proxy。当然我不是单一项目，而是多项目，这里会涉及正则。</p> <p>附上例子代码</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
  <span class="token keyword">listen</span> <span class="token number">80</span><span class="token punctuation">;</span>
  <span class="token keyword">server_name</span> _<span class="token punctuation">;</span>
  <span class="token keyword">charset</span> utf<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">;</span>
  <span class="token keyword">access_log</span> <span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>log<span class="token operator">/</span>nginx_access<span class="token punctuation">.</span>log main<span class="token punctuation">;</span>
  <span class="token keyword">error_log</span> <span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>log<span class="token operator">/</span>nginx_error<span class="token punctuation">.</span>log main<span class="token punctuation">;</span>
  <span class="token keyword">root</span> <span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>xxxx<span class="token operator">/</span><span class="token punctuation">;</span>
  <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>

  <span class="token keyword">location</span> <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span>api<span class="token operator">-</span>xxx <span class="token punctuation">{</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>xxxxx<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">location</span> <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span>api<span class="token operator">-</span>xxx <span class="token punctuation">{</span>
    <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>xxxxx<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">location</span> <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span>aaa <span class="token punctuation">{</span>
    <span class="token keyword">alias</span> <span class="token operator">/</span>xxxx<span class="token punctuation">;</span>
    <span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token operator">/</span>xxx<span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">location</span> <span class="token operator">^</span><span class="token operator">~</span> <span class="token operator">/</span>ccc <span class="token punctuation">{</span>
    <span class="token keyword">alias</span> <span class="token operator">/</span>xxxx<span class="token punctuation">;</span>
    <span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span><span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token variable">$uri</span><span class="token operator">/</span> <span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">;</span>
    <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>首先，我这边可能会有<code>www.xxx.com/h5</code>，<code>www.xxx.com/admin</code>的情况，而且我会根据<code>/api-xxx</code>的不同，去请求不同的服务。<code>location ^~ /aaa</code> 是针对spa的配置，<code>location ^~ /ccc</code>是针对静态化页面的配置。为啥我不用cdn去缓存html页面呢？不好意思业务问题不赘述。上述只是例子代码，你可以看思路，可别直接在线上用，业务不同需求不同。</p> <p>总结：善用脚本解决问题，减少重复劳动。</p> <h3 id="mock平台"><a href="#mock平台" aria-hidden="true" class="header-anchor">#</a> mock平台</h3> <p>首先你mock的平台最好做到0业务入侵，只切换变量即可，要配合好注释and文档。我的端口可能面对pc、mobile、小程序等。首先浏览器端，我会针对webpack的开发配置做改动。小程序我会二次封装<code>wx.request</code>。具体实现例子如下。</p> <p>所有浏览器端</p> <div class="language-test extra-class"><pre class="language-text"><code>// 开发环境 webpack dev server配置
const PATH = require('../package.json').conf_liberty['path'];
const URL = require('../package.json').conf_liberty['url'];

&quot;/api&quot;:{
  &quot;target&quot;: URL[PATH],
  &quot;pathRewrite&quot;: {
    &quot;^/api-xxx&quot;: &quot;/xxx&quot;,
  }
}
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token property">&quot;conf_liberty&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mock&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;mock&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://xxx.xxx.com/mock/xxx/&quot;</span> <span class="token punctuation">,</span><span class="token comment">// mock 数据请求地址</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://xxx.test.xxx.com&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 测试机的请求地址</span>
    <span class="token property">&quot;pre&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://xxx.xxx.com/&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 预发布的请求地址</span>
    <span class="token property">&quot;online&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://xxx.xxx.com/&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 正式环境的请求地址</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>小程序端</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// config/url.js</span>
<span class="token comment">/**
 * 小程序配置文件、切换环境直接切换变量即可
 * @param mock 模拟数据环境
 * @param test 测试环境
 * @param pre 线上测试环境
 * @param online 正式环境
 */</span>
<span class="token keyword">const</span> envir <span class="token operator">=</span> <span class="token string">'online'</span><span class="token punctuation">;</span><span class="token comment">// 环境阀门</span>
<span class="token keyword">const</span> configMap <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'mock'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">// mock 数据请求地址</span>
    url<span class="token punctuation">:</span> <span class="token string">'https://xxx.xxx.com/mock/xxx/'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'test'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">// 测试机的请求地址</span>
    url<span class="token punctuation">:</span> <span class="token string">'http://xxx.test.xxx.com'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'pre'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">// 预发布的请求地址</span>
    url<span class="token punctuation">:</span> <span class="token string">'http://xxx.xxx.com/'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'online'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">// 正式环境的请求地址</span>
    url<span class="token punctuation">:</span> <span class="token string">'http://xxx.xxx.com/'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> configMap<span class="token punctuation">[</span>envir<span class="token punctuation">]</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  baseUrl<span class="token punctuation">:</span> config<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 二次封装的wx.request</span>
<span class="token comment">// 为什么要封装成class，因为我有业务扩展，看个思路即可。</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>baseUrl<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../config/url'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">request</span> <span class="token punctuation">{</span>
  <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> params<span class="token punctuation">.</span>url <span class="token operator">=</span> baseUrl <span class="token operator">+</span> params<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
      wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token operator">...</span>params<span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">//</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">fail</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">//</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">complete</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
         <span class="token comment">//</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">request</span><span class="token punctuation">;</span>

</code></pre></div><p>每次开发，当开发人员和后端对好接口文档，到mock服务器写好mock，然后就可以在有数据的情况下愉快的开发了，而且的mock的数据更加全面带有随机性质符合前端开发人员需求，需要debug时甚至可以直接切换线上数据，但是操作线上数据需要时刻注意，这必须要引起开发人员重视。当然带有上传性质的接口，不太好测试。但是这点是可以解决的。需要和后端调试，我切换到test即可，多么的简单。我认为前端的很多的bug问题，都是数据的多样性导致开发人员没有考虑到，所带来的结果。</p> <p>mock平台的选择</p> <p>首先，我有两个种做法上的选择，线上服务器mock，本地服务器mock，我选择了线上服务器mock做法，因为我mock的数据会越来越多，提交到git上真难看，而且本地写json的形式，对于文档的整理不太友好，并且业务线确实有点多，需要总线式的管理，所有果断放弃。</p> <p>接下来，我对比的<code>easy-mock</code>，<code>yapi</code>，<code>云效平台</code>，三种mock服务器平台之后，我选择了<code>yapi</code>。先来说说我的标准，内网服务、搭建简单、升级容易、依赖少、不花钱，另外2种不是不好，只是我的选择而已。先说说<code>easy-mock</code>的我的看法，麻烦，依赖了<code>Node</code>、<code>MongoDB</code>、<code>Redis</code>，没有一键安装，一键化升级，甚至我还没找到如何升级，也许我眼拙。云效平台，我就看到了简介，怎么用我都没找到，阿里云的服务嘛，估计还要收费算了。来说说<code>yapi</code>，首先依赖轻，有<code>Node</code>、<code>MongoDB</code>就好了。安装太简单<code>npm install -g yapi-cli</code>，执行一下<code>yapi server</code>，配置一下数据库，点一点就ok了。我就花了1个小时左右就搞定了。后续升级<code>yapi update</code>一下好了。多么的愉快。而且基本满足我的需求，基本的mock、高级的mock、文档导入导出非常完美，甚至能测试线上数据，简单的<code>postman</code>功能也行，连nginx配置官方都帮我想好了。目前我已经在全部业务线使用，而且推荐给客户端、后端同学使用，只能说好评连连。而且以我粗浅的能力，尚能看得懂<code>yapi</code>的机制，就算官方不维护了，我也能打打补丁。想知道如何安装的，去<a href="https://yapi.ymfe.org/index.html" target="_blank" rel="noopener noreferrer">yapi<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>官网看就好了。</p> <p>安装方法</p> <p>来说说我的安装方法把，首先我会在本地安装<code>npm install -g yapi-cli</code>，做好基本调试，配置好数据库，我用的是远程数据库。写好<code>config.json</code>基本配置，然后push到git上。到指定服务器pull即可，安好pm2，启动。后续升级也是这样，先本地升级测试一下，然后到服务器pull重启，当然这是可以结合jekins。</p> <p>总结：这种工具服务的选择没有啥对错，只要符合当前业务开发，并且可以基本的持续迭代即可，自主研发也好，第三方服务也罢，怎么都行，一切以加速业务开发为导向。</p> <h2 id="私有的npm"><a href="#私有的npm" aria-hidden="true" class="header-anchor">#</a> 私有的npm</h2> <p>首先业务线有点多，而且基本可以做到一些方法复用例如：客户端版本判断、UA检测、统计服务、JSbridge等等，组件二次封装等。例如：ant design的图片上传，你每次写一堆配置，其实你需要配置的无非是<code>action</code>，<code>disabled</code>，<code>onChange</code>，<code>name</code>你是不是可以跟后端商量固定<code>action</code>，给一个当前业务的基础接口做成业务组件。再极端一点，我完全可以做成npm包，让后端同学提供一个完全独立的服务。我发现很多前端，对于UI库是真拿来主义，拿来就用，拜托，你有没有发现，其实你每次用UI库里面的东西，写一坨不累么。人家组件是为了适应90%场景的，而你在实际业务中所用到可能不到10%。请你提高一下自己的效率可好？</p> <p>例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 经过二次封装的上传组建</span>
<span class="token keyword">let</span> upladFileConf <span class="token operator">=</span> <span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">'上传'</span><span class="token punctuation">,</span><span class="token comment">// 按钮内容</span>
  disabled<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">// 是否禁用</span>
  <span class="token function-variable function">callBack</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleUpload</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// 成功回调</span>
  <span class="token function-variable function">callError</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// 失败回调</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>UpladFile <span class="token punctuation">{</span><span class="token operator">...</span>upladFileConf<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 经过二次封装的弹窗组件</span>
<span class="token keyword">const</span> conf <span class="token operator">=</span> <span class="token punctuation">{</span>
  visible<span class="token punctuation">:</span> visible<span class="token punctuation">,</span><span class="token comment">// 是否显示</span>
  title<span class="token punctuation">:</span> <span class="token string">'弹窗标题'</span><span class="token punctuation">,</span><span class="token comment">// 标题</span>
  <span class="token function-variable function">onCancel</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onCancel</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// 确定按钮or取消按钮，回调</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Modal <span class="token punctuation">{</span><span class="token operator">...</span>conf<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Modal<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>私有npm服务选择</p> <p>先说我的需求，简单好用，稳定，方便部署，及时通知，在我对比的<code>cnpm</code>、<code>sinopia</code>、<code>verdaccio</code>、<code>Nexus</code>之后。我的结论是<code>verdaccio</code>，<code>cnpm</code>感觉插件有点少貌似，没有钉钉推送的插件，<code>sinopia</code>都凉了不考虑，<code>Nexus</code>吧没必要，我就前端用用而已。<code>verdaccio</code>目前看到还行，继承了<code>sinopia</code>，插件满足我的需求，安装简单，上线小半年没啥问题，目前有十几个私有包，连数据库都不用折腾。路径切换选择用<code>nrm</code>即可。</p> <p>安装方法</p> <p>首先我依旧会在本地安装好，<code>npm install -g verdaccio</code>，配置好<code>config.yaml</code>，装好钉钉通知，做好目录屏蔽，然后迁移到我的git中，然后书写shell脚本。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># build.sh</span>
<span class="token comment"># /bin/bash</span>
<span class="token comment"># 启动私有npm脚本</span>

<span class="token assign-left variable">work_path</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>
verdaccio --listen <span class="token number">4873</span> --config <span class="token variable">${work_path}</span><span class="token string">&quot;/verdaccio/config.yaml&quot;</span>
</code></pre></div><p>然后每次我需要调试配置时，我先在本地测试，push一下，到服务器pull一下，执行<code>pm2 start build.sh</code>或者<code>pm2 restart build</code>。当然这也是可以加到jekins。</p> <p>注意</p> <p>yaml这种配置文件请认真去研究一下怎么写，缩进空格有点不同。<code>storage/.sinopia-db.json</code>一定要是json格式不能为空，而且内容可以是<code>{&quot;list&quot;:[],&quot;secret&quot;:&quot;&quot;}</code></p> <p>总结：其实搭建私有npm不难，难在如何设置私有npm包的发布规则，互相依赖升级等，可以用lerna来做。私有npm规则，以及lerna的使用，等我稍后总结。</p> <h2 id="项目模版"><a href="#项目模版" aria-hidden="true" class="header-anchor">#</a> 项目模版</h2> <p>每次new cli我不反对，但是真的不累么，那么多包要加，有些特有的地方架子还要改。目前我总结出3套，ant-admin-template、nuxt-mobile-template、spa-mobile-template。</p> <p>实现方法（只以admin例子）</p> <p>新开目录，然后执行new cli，生成基础项目模版。对基础模版做一些调整，并且安装一些基础包</p> <p>调整的基础模版</p> <div class="language-text extra-class"><pre class="language-text"><code>|----- dist/                            正式环境产出
|----- conf/                            配置文件
        |----- alias.js                 公共路径配置文件
        |----- development.js           开发环境配置文件
        |----- production.js            正式环境配置文件
        |----- oss.js                   build之后将文件上传到oss
|----- src/                             开发目录
        |----- components/              公共业务组件
        |----- pages/                   页面
        |----- hoc/                     HOC
        |----- serverice/               中间层
        |----- utils/                   通用方法
        |----- index.css                主css
        |----- index.js                 主入口文件
        |----- router.js                路由装载配置
|----- .editorconfig                    统一开发格式配置文件
|----- .eslintrc                        开发格式配置文件
|----- .webpackrc.js                    webpack配置文件
|----- .gitignore                       git提交屏蔽文件
|----- package.json                     npm配置文件
|----- index.ejs                        index.html模版文件

-------------分割线----------------

scr/pages
pages
|----- index.js                                 出口文件
|----- [name]Page                               集成业务代码
        |----- index.js                         集成页面view，model，router
        |----- components                       当前业务专属组件
                |----- index.js                 view层
        |----- [name]                           业务文件夹
                |----- model.js                 model层
                |----- [name]Component.js       当前page专属组件
</code></pre></div><p>可能用到的插件包，可自行删减</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;axios&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.18.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;prop-types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^15.6.1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;qs&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.7.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;ali-oss&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^6.0.1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;underscore&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.9.1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.1.2&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;@xxx/xxx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^x.x.x&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 私有包</span>
<span class="token punctuation">}</span>
</code></pre></div><p>制作完成，push到git中，如果需要新开管理台，只要pull，<code>npm i</code>，改改nginx即可。nginx我已经脚本化了，很简单就能部署。</p> <p>注意</p> <p>登陆、退出、鉴权，预留空间出来，因为每个项目都会有细微差别，让开发人员自行修改即可。</p> <p>总结：这种项目模版形式，快速开发新业务线，例如运营管理台、财务管理台、等等内部管理台使用，或者作为spa骨架，小程序骨架，pc骨架，为啥要开这么多管理台？少年，你，财务系统、erp系统、cms系统、售后系统，真的不要切分开来么？有精力做权限切分，搞的一个项目臃肿不堪，不如独立。每个平台有自己的账户登陆权限。简单省事，反正都是一套架子，也不存在什么跨项目。升级的话，基础目录即结构不变，升级npm包、升级私有npm包即可。请记住，看上去合并很容易，但复杂度高。分开会加速开发，同时降低复杂度。</p> <h2 id="服务器初始化"><a href="#服务器初始化" aria-hidden="true" class="header-anchor">#</a> 服务器初始化</h2> <p>快速在服务器上安装git、nrm、nvm，当然这个是一次性的，后续我做镜像即可。当然有些特殊情况，我也会用到，例如我要制作新的镜像。直接贴代码把不解释了。</p> <p>安装git</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># 安装最新git</span>
<span class="token comment"># 需要exit之后再次进入机器，git命令才会生效</span>
yum <span class="token function">install</span> curl-devel expat-devel gettext-devel openssl-devel zlib-devel asciidoc <span class="token function">wget</span>
yum <span class="token function">install</span> gcc perl-ExtUtils-MakeMaker
yum remove <span class="token function">git</span>
<span class="token builtin class-name">cd</span> /usr/local/src/
<span class="token function">wget</span> https://www.kernel.org/pub/software/scm/git/git-2.15.1.tar.xz
<span class="token function">tar</span> -vxf git-2.15.1.tar.xz
<span class="token builtin class-name">cd</span> git-2.15.1
<span class="token function">make</span> <span class="token assign-left variable">prefix</span><span class="token operator">=</span>/usr/local/git all
<span class="token function">make</span> <span class="token assign-left variable">prefix</span><span class="token operator">=</span>/usr/local/git <span class="token function">install</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;export PATH=<span class="token environment constant">$PATH</span>:/usr/local/git/bin&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/profile
<span class="token builtin class-name">source</span> /etc/profile
<span class="token function">git</span> --version
</code></pre></div><p>安装nvm</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># 安装nvm作为node版本控制</span>
<span class="token comment"># 需要exit之后再次进入机器，nvm命令才会生效</span>
<span class="token function">wget</span> -qO- https://raw.githubusercontent.com/creationix/nvm/v0.34.0/install.sh <span class="token operator">|</span> <span class="token function">bash</span>
</code></pre></div><p>安装nrm</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># 安装nrm作为npm线路控制</span>
<span class="token function">npm</span> <span class="token function">install</span> -g nrm
nrm <span class="token function">ls</span>
</code></pre></div><p>注意：先安装git、nvm，再安装nrm</p> <p>总结：拒绝重复劳动，我只需要touch git.sh &amp;&amp; vim git.sh，拷贝代码，执行即可。当然你可以说制作docker镜像，目前我还没研究透彻。公司专业的运维同学也怪忙的，我只能稍微请教一番，还是我自己先动手把。</p> <h2 id="非代码层面的测试交付"><a href="#非代码层面的测试交付" aria-hidden="true" class="header-anchor">#</a> 非代码层面的测试交付</h2> <p>代码层面，通过mock、eslint、code review、单元测试等手段测试可以良好把控。前端程序员很多问题都是跨端，不同app版本测试所带来的。这里我会要求开发人员空出一天或者半天时间，整理业务点，梳理测试的表格。当然也会有，没有测试到的点，这可以通过补充慢慢完善。这东西一般会在大促使用、或者是重要功能，重要项目使用。梳理完成之后，我都会要求开发人员以邮件形式抄送给我，我会二次检查，在项目上线半天前，我会再次要求开发人员以邮件形式抄送给我查看情况，预留给绩效考核，以及我再次检查确认是否有遗漏。</p> <p>例如：</p> <p>移动端</p> <ul><li>UI兼容测试
<ul><li>[ ] iphoneX
<ul><li>[ ] xxx页面</li> <li>[ ] xxx页面</li> <li>[ ] xxx页面</li></ul></li> <li>[ ] iPhone XS
<ul><li>[ ] xxx页面</li> <li>[ ] xxx页面</li> <li>[ ] xxx页面</li></ul></li> <li>[ ] iphone8
<ul><li>[ ] xxx页面</li> <li>[ ] xxx页面</li> <li>[ ] xxx页面</li></ul></li> <li>[ ] 小米8
<ul><li>[ ] xxx页面</li> <li>[ ] xxx页面</li> <li>[ ] xxx页面</li></ul></li> <li>[ ] 小米7
<ul><li>[ ] xxx页面</li> <li>[ ] xxx页面</li> <li>[ ] xxx页面</li></ul></li> <li>[ ] 红米
<ul><li>[ ] xxx页面</li> <li>[ ] xxx页面</li> <li>[ ] xxx页面</li></ul></li></ul></li></ul> <p>andorid版本测试</p> <ul><li><p>x.x.x</p> <ul><li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li></ul></li> <li><p>x.x.x</p> <ul><li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li></ul></li></ul> <p>ios版本测试</p> <ul><li><p>x.x.x</p> <ul><li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li></ul></li> <li><p>x.x.x</p> <ul><li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li></ul></li></ul> <p>微信端测试</p> <ul><li>x.x.x
<ul><li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li></ul></li></ul> <p>pc端</p> <p>UI兼容测试</p> <ul><li>[ ] xx浏览器 x.x.x版本
<ul><li>[ ] xxx页面</li> <li>[ ] xxx页面</li> <li>[ ] xxx页面</li></ul></li> <li>[ ] xx浏览器 x.x.x版本
<ul><li>[ ] xxx页面</li> <li>[ ] xxx页面</li> <li>[ ] xxx页面</li></ul></li></ul> <p>xx浏览器 x.x.x版本功能测试</p> <ul><li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li></ul> <p>xx浏览器 x.x.x版本功能测试</p> <ul><li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li> <li>[ ] 页面功能点</li></ul> <p>总结：不是有专业的测试人员么？不好意思，作为程序员自测都不能通过，还写啥代码，还写啥好代码。bug是跟绩效挂钩的，就问你要钱吗？绩效漂亮了，每个季度发钱，大大的给，不爽么？你出去找工作底气足吗？大声喊出，我有完备的测试流程，我写的代码基本0bug，不骄傲么？</p> <h2 id="错误监控"><a href="#错误监控" aria-hidden="true" class="header-anchor">#</a> 错误监控</h2> <p>抓取页面js异常，上报UA/错误提示信息、分析日志/5xx/4xx、CDN异常监控、设置n min之内5xx，4xx阈值，这些都是基础运维服务的东西不深入。关注小程序的开发 &gt; 错误查询/性能监控/告警设置。这一块我尚未特别深入，其实都是阿里云的服务设置一下，或者每天检查微信公众平台，或者使用第三方监控平台。有机会详谈。</p> <p>总结：错误监控，大部分都是基于日志系统的，前端唯一特殊的点就是会有js报错的情况，称之为崩溃率。反正基于日志就对了。pv、uv的？？？？喵喵喵</p> <h2 id="获取最新信息"><a href="#获取最新信息" aria-hidden="true" class="header-anchor">#</a> 获取最新信息</h2> <p>请用rss订阅的方式，订阅你所使用的开源项目，第一时间获取，version信息、commit信息、fixbug信息，作为leader你要时刻掌握最新咨询，而不是被人告知。</p> <h2 id="结语"><a href="#结语" aria-hidden="true" class="header-anchor">#</a> 结语</h2> <p>不好意思，洋洋洒洒写了这么多，能看到这里的，也不容易，牛逼了老弟/老哥/老妹/老姐。说老实话，还有很多地方没说，例如：脚本化小程序发布、脚本化发布多个端的小程序、eslint的使用细节、webhook的使用如何禁止merge、githook细节、commit log 规范、打tag包、钉钉的推送、cdn部署、code review的标准、npm包的标准、单元测试的普及、性能监控、api切分、用中间页鉴权、设备指纹、支付安全、将bs构架快读切换cs构架、如何保证多个项目同时在测试环境同时交付测试、灰度发布等等还有很多东西把，这些就等我慢慢体验了，慢慢整理了。</p> <p>这些东西为就不能称之为架构，只是我个人的一些逗比操作而已，这套东西3～10人小团队，20条业务线，给我的感觉是可以撑住的。前提是在业务量在高速增长的情况下使用。我曾经问过我师傅，为啥，他在的时候不做，明明他都懂。他回答的是：“公司在什么阶段做什么事情，当公司在寻找主营业务，不停试错时，你固化的构架，就不适合这家公司，当公司寻找到这个点之后，你用构架就能快速辅助开发，业务其实没啥写的，就看怎么写的快，跟上市场，让公司能快速响应市场，或者引领市场”。好吧，我服气</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs-interview/assets/js/app.95d31192.js" defer></script><script src="/docs-interview/assets/js/2.387e38e1.js" defer></script><script src="/docs-interview/assets/js/21.dceec1d2.js" defer></script>
  </body>
</html>
