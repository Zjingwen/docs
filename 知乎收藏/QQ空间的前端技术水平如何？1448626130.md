# QQ空间的前端技术水平如何？

利益相关：QQ空间 web前端开发，你吐槽的页面，就是我做的。  

![](https://pic4.zhimg.com/2820f63660125c07843a12bebdc0a1eb_b.jpg)  

知乎从来都是只看不答，这次为了答题，总算注册一个知乎大号。这个回答仅对题主提出的做的不好的地方做下反思和一些解释，至于技术牛不牛，不在这里探讨，反正我是不牛的那个。  

妈妈说做错了就得承认，黄老师说不能鸭子死了嘴壳子硬。感谢题主指出了问题，让我可以再回过头来看做得不好的地方（老大总算要安排时间给我优化啦，哈哈哈）。  

一开始，关于文件数加载，先提出我的看法：  
1.最重要的时间是什么，是用户首次可交互时间，那么为了尽可能的优化这个时间，我们要保证在这之前请求尽可能的少，这是必须做到极致的。  
2.有些功能，用户一进来并不会立刻使用，那么这些功能的文件，只需要在用户准备用它之前加载好即可。什么时候加载，多少个请求，其实影响不大。  

好啦，下边一个一个的说吧。  

**1.加载了114个js文件**  
我进自己空间，清掉缓存，无缓存状态，js 122个，吓尿了。  
![](https://pic2.zhimg.com/ffc728c88bb66ad0a7b72f6b296e7029_b.png)  
再次进空间，带缓存访问，还好，文件数虽多，大多数都是从from cache，还好还好。  
![](https://pic2.zhimg.com/9af23815571a78b358200855748592b9_b.png)  
回过来继续看哪些文件可合并，哪些文件不可合并。逐个说下吧。  

1）基础库文件 3个  
![](https://pic1.zhimg.com/1262539b7fc97adaeeb1db9c913f8c50_b.png)这几个是基础库，可不可以合呢？当然可以合，为什么不合呢？基础库文件基本是不会改动的，我们又设置了长缓存。对大部分用户来说，这个文件是会使用缓存的，如果我们把这3个文件突然改成合并加载，所有用户都会重新下载这部分文件，浪费流量啊，浪费流量就是浪费钱。  
![](https://pic3.zhimg.com/e1aa1d85820ed29858df1fadc830b132_b.png)  
2）说说发表框的文件 3个  
![](https://pic4.zhimg.com/5f7f69cde064f6eeed8420796186df93_b.png)这些文件可不可以合呢，从抓包可以看出，其实我是合了的。为什么是3个而不是1个呢？因为合成1个url就太长了，超出老ie的限制，就要报错。没办法，拆成3个。那为什么不低版本ie 3个请求，新版本浏览器1个请求呢？有些其他原因，这里不好说  

3）个人中心的各种模块 8个文件  
![](https://pic4.zhimg.com/28d960269be8ae8c89b471b557232163_b.png)  
这里的合并没做好，从长度上来说，可以减少到3到4个请求，这里有优化空间  

4）音乐播放器文件 3个  
![](https://pic2.zhimg.com/3454fe8f409bb9169aec3fa7e195199d_b.png)这里也有优化空间，不多说啦  

5）评论框的文件 20个  
![](https://pic1.zhimg.com/e6d347d92c17e99850f273df9f2748fc_b.png)这个可以合并一下，为什么之前不合并呢？要讲好长一个故事，题主估计也不想听，不废话啦  

6）其他接入的团队的文件 11个  
![](https://pic1.zhimg.com/7e7b49fb2d4ab9174eb46c1ec4354cdc_b.png)![](https://pic4.zhimg.com/0e612c0062a22be74ded4ebdb343c24b_b.png)  
合不合呢？我也想合，待我去问问  

7）/qzone/mall/目录文件 6个  
![](https://pic2.zhimg.com/76c59977cf7bbda8eebbf04e159d0a91_b.png)有个基础库重复加载啦，惭愧惭愧。其他的代码都是一些功能模块，可以合并么？也可以，不过这些模块进某些页面时用，有些页面时不用，而且不是首屏的功能，多几个请求对体验的影响不大。总的来说，合也可，不合也可。  

8）/qzone/photo/目录文件 8个  
![](https://pic4.zhimg.com/0bd0991025c5aa716d61943e94de5ccb_b.png)这个目录的文件倒是可以把请求合并一下，预计可以减少到3 到4个请求。  

9）又是一堆功能模块 37个  
![](https://pic2.zhimg.com/58f698836b8cc8128934bac99e574afd_b.png)这里也可以优化，预计可以减少到8个以内  

10）3个配置文件  
![](https://pic2.zhimg.com/e79cb5376716f3147169c1140e107cd1_b.png)可以合，不过合并后，1个文件变更会导致其他文件也重新下载，性价比不高。而且这些文件并不会在第一屏加载。合不合对体验的影响不大。  

综上，预计优化后总请求数在40个以内。还有优化空间的，我们也可以再探讨  

**2.对最高赞的匿名用户（请原谅，你匿名了，我只能这样称呼你了）提出的问题稍微解释下：**  

1）有些文件没混淆，有些文件混淆了。  
为什么呢？我们是在发布系统上做的压缩混淆。最开始是指做压缩，不做混淆的。在某个时间点才开启了混淆。只要在那个时间点之后发布的文件，就是做过混淆的。我的看法是，如果经常改的文件，下次修改发布后，自然就混淆了。如果不是经常改的文件，有没有必要去混淆呢？得看收益了  
那旧文件要不要去混淆呢？我们找个文件分析一下吧。  
以这个文件为例：  
[http://qzonestyle.gtimg.cn/qzone/photo/v7/js/lib/photo.js](http://ctc.qzonestyle.gtimg.cn/qzone/photo/v7/js/lib/photo.js)  
原始文件大小：136K  
只去注释换行空格，开启gzip，大小：21k  
去注释换行混淆，开启gzip，大小：19k  
以上的结果可以看出，做不做混淆，对一个136k的文件来说，影响在2k。  
我们当时的策略是：对cdn上流量较大的文件，重新发布一遍，做混淆。流量小的，就等到下个版本发布时就混淆。一直等不到下个版本的，流量又小的，就不管了。  

你又可能会问：把所有旧代码发布一遍，很麻烦么？发布不麻烦，麻烦的是，有些旧代码过不了gcc simple级别的压缩，重新发布一遍（上万个文件），意味着发布的时候得花很多时间去改旧代码。时间就耗进去，需求不做了么？不做需求，那么还要不要领工资呢？不领工资，回家老婆要买驴牌，孩子要学跳舞，这些都要钱啊！面对现实，还是忍了  

2）中英文混搭  
![](https://pic4.zhimg.com/1202bd49d55959e6ee4021e2ffb75a5b_b.png)中英文混搭的地方确实很多，没办法，读了这么多年书，最对不起就是英文老师。不过你这个例子举得不好，因为这里的dianping指的就是大众点评，如果我去改成英文什么的，反而更影响了理解。  

3）空if  
这里实在是惭愧，不解释，接受打脸。  

4）代码审查的力度  
这也是我想吐槽的，如果借这个机会能换的大家的重视，这脸打得值得。  

感谢你能看到这里。  

最后的最后，题主和那位匿名的兄弟，如果有兴趣，可以私信我，如果我们彼此能看上眼，可以来我们这里试试。  

20151117